ifeq ("$(HCLIB_ROOT)", "")
  $(error Please set the HCLIB_ROOT environment variable.)
endif

PROJECT_BASE_FLAGS = -I$(HCLIB_ROOT)/include \
                     -pthread $(shell xml2-config --cflags)
PROJECT_CFLAGS     = -std=c11 $(PROJECT_BASE_FLAGS)
PROJECT_CXXFLAGS   = -std=c++11 $(PROJECT_BASE_FLAGS)
PROJECT_LDFLAGS    = -L$(HCLIB_ROOT)/lib
PROJECT_LDLIBS     = -l$(PROJECT_HCLIB) -Wl,-rpath,$(HCLIB_ROOT)/lib $(shell xml2-config --libs) -lpthread


# release target signals that production flags should be used
.PHONY: release

PROJECT_GOALS ?= $(MAKECMDGOALS)

ifeq (,$(filter $(PROJECT_GOALS),release))
  # debug flags
  PROJECT_HCLIB        = hclib_dbg
  PROJECT_TARGET_TYPE  = debug
  PROJECT_BASE_FLAGS  += -g -O@dbg_flag_lvl@ -DHCLIB_DEBUG
else
  # release flags
  PROJECT_HCLIB        = hclib
  PROJECT_TARGET_TYPE  = release
  PROJECT_BASE_FLAGS  += -O3 -DNDEBUG
endif

ifdef TBB_MALLOC
  PROJECT_LDFLAGS += -L$(TBB_MALLOC)
  PROJECT_LDLIBS  += -ltbbmalloc_proxy
endif
